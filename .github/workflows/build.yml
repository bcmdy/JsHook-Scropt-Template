# ğŸ› ï¸ æ„å»ºè„šæœ¬
name: ğŸ› ï¸ æ„å»ºè„šæœ¬
# è¿™æ˜¯ä¸€ä¸ªæ„å»ºè„šæœ¬çš„å·¥ä½œæµç¨‹
# å·¥ä½œæµç¨‹è§¦å‘æ¡ä»¶
on:
  # å½“pushåˆ°mainåˆ†æ”¯æ—¶è§¦å‘
  push:
    branches: [ "main" ]
  # å½“æ‰‹åŠ¨è§¦å‘æ—¶è§¦å‘
  workflow_dispatch:

# å·¥ä½œæµæƒé™
permissions:
  # å¯å†™å†…å®¹æƒé™
  contents: write

# ä¸€ä¸ªå·¥ä½œæµç”±ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ç»„æˆ
jobs:
  # ä¸€ä¸ªåä¸º "build" çš„ä»»åŠ¡
  build:
    # æŒ‡å®šè¯¥ä»»åŠ¡è¿è¡Œçš„è™šæ‹Ÿç¯å¢ƒï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ Ubuntu
    runs-on: ubuntu-latest
    # ä»»åŠ¡çš„æ­¥éª¤
    steps:
      # æ£€å‡ºä»£ç 
      - name: ğŸ“‚ æ£€å‡ºä»£ç  # ç¬¬ä¸€æ­¥ï¼Œæ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v4 # ä½¿ç”¨ actions/checkout è¿™ä¸ªç¬¬ä¸‰æ–¹ Action æ¥æ£€å‡ºä»£ç 
      
      - name: ğŸ“¦ é…ç½® Node.js ç¯å¢ƒ # ç¬¬äºŒæ­¥ï¼Œé…ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with: # é…ç½®å‚æ•°
          node-version: 20 # æŒ‡å®š Node.js ç‰ˆæœ¬ä¸º 20
          
      - name: â° è®¾ç½®æ„å»ºæ—¥æœŸ # ç¬¬ä¸‰æ­¥ï¼Œè®¾ç½®æ„å»ºæ—¥æœŸ
        id: builddate # è¯¥æ­¥éª¤çš„ ID ä¸º builddate
        # ä½¿ç”¨ shell å‘½ä»¤å°†æ„å»ºæ—¥æœŸå†™å…¥ GitHub ç¯å¢ƒå˜é‡ä¸­
        run: echo "BUILD_DATE=$(date +'%Y%m%d')" >> $GITHUB_ENV
        # $GITHUB_ENV æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºå­˜å‚¨å·¥ä½œæµç¨‹çš„ç¯å¢ƒå˜é‡
        # è¿™é‡Œä½¿ç”¨ echo å‘½ä»¤å°†æ„å»ºæ—¥æœŸå†™å…¥è¯¥ç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­æ­¥éª¤ä½¿ç”¨
        # æ ¼å¼ä¸º YYYYMMDDï¼Œæ—¥æœŸæ ¼å¼ä¸ºå››ä½å¹´ä»½+ä¸¤ä½æœˆä»½+ä¸¤ä½æ—¥æœŸ
        
      - name: ğŸ”¨ æ„å»ºè„šæœ¬ # ç¬¬å››æ­¥ï¼Œæ„å»ºè„šæœ¬
        # ä½¿ç”¨ git å…‹éš†ä»“åº“åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹
        run: |
          # å…‹éš†ä»“åº“åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹
          git clone https://github.com/bcmdy/JsHook-Scropt-Template Script.tmp
          # ç»™ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™
          chmod +x -R ./Script.tmp
          # åˆ‡æ¢åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹
          cd ./Script.tmp
          # æ‰§è¡Œ npm run build å‘½ä»¤è¿›è¡Œæ„å»º
          npm run build

      # åˆ›å»º GitHub Release çš„æ­¥éª¤
      - name: ğŸ åˆ›å»º GitHub Release (${{ github.run_number }})
        env:
          # ä» GitHub ç¯å¢ƒå˜é‡ä¸­è·å–æ„å»ºæ—¥æœŸ
          BUILD_DATE: ${{ env.BUILD_DATE }}
        continue-on-error: true
        # ä½¿ç”¨ softprops/action-gh-release åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v2
        # æŒ‡å®š Release çš„ tag åç§°ï¼Œä½¿ç”¨ GitHub ç¯å¢ƒå˜é‡ä¸­çš„æ„å»ºæ—¥æœŸ
        with:
          # æŒ‡å®š Release çš„ tag åç§°
          tag_name: ${{ env.BUILD_DATE }}_v${{ github.run_number }}
          # æŒ‡å®š Release çš„æ–‡ä»¶åˆ—è¡¨
          files: "Script.tmp/dist/build.js"
          generate_release_notes: true



