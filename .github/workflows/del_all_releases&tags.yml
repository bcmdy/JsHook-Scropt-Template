name: ğŸ”¥ åˆ é™¤æ‰€æœ‰ Releases ä¸ Tags

# å·¥ä½œæµç¨‹è§¦å‘æ¡ä»¶
on:
  # å½“æ‰‹åŠ¨è§¦å‘æ—¶è§¦å‘
  workflow_dispatch:
    # æ·»åŠ ç¡®è®¤è¾“å…¥ï¼Œç¡®ä¿åˆ é™¤æ“ä½œè¢«æ‰§è¡Œ
    inputs:
      confirm:
        description: 'ç¡®è®¤åˆ é™¤æ‰€æœ‰ Releases ä¸ Tags (è¾“å…¥ CONFIRM ä»¥ç»§ç»­)'
        required: true

# å·¥ä½œæµæƒé™
permissions:
  # å¯å†™å†…å®¹æƒé™
  contents: write

jobs:
  delete_releases_and_tags:
    runs-on: ubuntu-latest
    env:
      # è·å– GitHub Token ç”¨äºæ‰§è¡Œ GitHub API æ“ä½œ
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    # ç¡®è®¤è¾“å…¥ä¸º CONFIRM æ—¶æ‰§è¡Œåˆ é™¤æ“ä½œ
    if: github.event.inputs.confirm == 'CONFIRM'
    steps:
      # æ£€å‡ºä»£ç 
      - name: ğŸ“‚ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # åˆ é™¤æ‰€æœ‰ Releases

      - name: ğŸ’¥ åˆ é™¤æ‰€æœ‰ Releases
        uses: actions/github-script@v7
        with:
          script: |
            // è·å–æ‰€æœ‰ Releases
            const releases = await github.rest.repos.listReleases({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });
            // åˆ é™¤æ¯ä¸ª Releases
            for (const release of releases.data) {
              console.log(`åˆ é™¤ Release: ${release.name}`);
              await github.rest.repos.deleteRelease({
                owner: context.repo.owner,
                repo: context.repo.repo,
                release_id: release.id,
              });
            }

      # åˆ é™¤æ‰€æœ‰ tags
      - name: ğŸ”¥ åˆ é™¤æ‰€æœ‰ Tags
        run: |
          # è·å–æ‰€æœ‰ tags
          git fetch --tags
          # åˆ é™¤æ¯ä¸ª tags
          git tag -l | xargs -n 1 git push --delete origin
          # æ¸…ç†æœ¬åœ°ç¼“å­˜
          git fetch --prune
